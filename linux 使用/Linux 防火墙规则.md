# Linux 防火墙配置

## 添加规则

- 命令行开启 `22` 端口

```
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
```

- 添加细致规则限制到机器

```
iptables -A INPUT -s 192.168.0.100 -p tcp --dport 22 -j ACCEPT
```

**使用命令行添加规则，重启后规则失效。**

## iptables 配置文件

- CentOS 下 iptables 配置文件路径：

```
/etc/sysconfig/iptables
```

- 文件内容：

```
# Generated by iptables-save v1.4.21 on Sat Mar 19 08:04:01 2016
*filter
:INPUT DROP [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [1:136]
:syn-flood - [0:0]
-A INPUT -i lo -j ACCEPT
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 21 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 3306 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 8080 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 60000:60003 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 20000:30000 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT
-A INPUT -p icmp -m limit --limit 100/sec --limit-burst 100 -j ACCEPT
-A INPUT -p icmp -m limit --limit 1/sec --limit-burst 10 -j ACCEPT
-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j syn-flood
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A syn-flood -p tcp -m limit --limit 3/sec --limit-burst 6 -j RETURN
-A syn-flood -j REJECT --reject-with icmp-port-unreachable
COMMIT
```

开放 8080 ， 开放 60000到60003 端口。

```
-A INPUT -p tcp -m state --state NEW -m tcp --dport 8080 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 60000:60003 -j ACCEPT
```

## Ubuntu 下的防火墙

系统：

```
elementory os 0.4
```

查看防火墙规则：

```
sudo iptables -L
```

防火墙默认是关闭的。

> WARNING: Iptables and NetworkManager can conflict. Also if you are concerned enough about security to install a firewall you might not want to trust NetworkManager. Also note NetworkManager and iptables have opposite aims. Iptables aims to keep any questionable network traffic out. NetworkManager aims to keep you connected at all times. Therefore if you want security all the time, run iptables at boot time. If you want security some of the time then NetworkManager might be the right choice.

保存规则比较麻烦，还可能会发生冲突，作为一个小白止步于此了。

## CentOS 7 firewall

```
systemctl stop firewalld.service #停止firewall
systemctl disable firewalld.service #禁止firewall开机启动

yum install iptables-services #安装
systemctl restart iptables.service #最后重启防火墙使配置生效
systemctl enable iptables.service #设置防火墙开机启动
```

## 参考链接

- [Linux配置防火墙详细步骤（iptables命令使用）](https://my.oschina.net/799835984/blog/663361)
- [CentOS下配置iptables防火墙](http://os.51cto.com/art/201103/249398.htm)
- [Iptables (简体中文)](https://wiki.archlinux.org/index.php/iptables_%28%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%29)
- [IptablesHowTo](https://help.ubuntu.com/community/IptablesHowTo)
- [CentOS7下Firewall防火墙配置用法详解](http://www.centoscn.com/CentOS/Intermediate/2015/0313/4879.html)
- [centos7 关闭firewall安装iptables并配置](http://linux.it.net.cn/CentOS/fast/2015/0110/11567.html)
